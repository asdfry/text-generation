services:
  trainer-gpfs:
    image: asdfry/train-llm:20231129
    volumes:
      - /gpfs/jsh/volume:/root/mnt
    command: ["/bin/bash", "-c", "/usr/sbin/sshd -p 1040 && sleep infinity"]
    ports:
      - 1040:1040
    shm_size: 1GB
    # network_mode: host
    # privileged: true
    deploy:
      resources:
        reservations:
          devices:
          - driver: nvidia
            count: all
            # device_ids: ['0', '1', '2', '3']
            capabilities: [gpu]
  # trainer-ontap:
  #   image: asdfry/train-llm:20231129
  #   volumes:
  #     - /ontap/jsh/volume:/root/mnt
  #   command: ["/bin/bash", "-c", "/usr/sbin/sshd -p 1041 && sleep infinity"]
  #   ports:
  #     - 1041:1041
  #   shm_size: 1GB
  #   # network_mode: host
  #   # privileged: true
  #   deploy:
  #     resources:
  #       reservations:
  #         devices:
  #         - driver: nvidia
  #           device_ids: ['4', '5', '6', '7']
  #           capabilities: [gpu]
